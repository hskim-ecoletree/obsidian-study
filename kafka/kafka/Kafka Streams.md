# 1. 카프카 스트림즈란?

- 카프카 클러스터의 이벤트 스트림에 대해 스트리밍 처리를 용이하게 구현할 수 있도록 도움을 주는 자바 라이브러리
- 자바의 stream api 와 같이 데이터 스트림 처리를 위한 고수준 추상화 API 를 제공하는 Streams DSL
- 세세한 제어가 필요할 때 사용하는 저수준의 Processor API
- 이벤트 스트림을 테이블(Ktable & GlobalKTable), 스트림(KStream) 로 추상화(데이터 모델링) 가능
- 데이터 변환, 보강, 조인, 집계 등의 기능 제공
- 상태가 있는 스트림 처리가 가능
- 윈도우 처리와 주기적인 함수 실행 등 시간-기반 연산 지원
- 쉬운 설치, 단순 자바 라이브러리이기 때문에 별도 설치할 것이 없음
- 높은 확장성, 신뢰성, 유지 보수성

# 2. 프로세서 토폴로지 (Processor Topology)

프로세서 토폴로지는 스트림 처리 코드의 논리적인 추상화이며, 일련의 작업을 방향성 비순환 그래프 _<sub>DAG, Directed Acyclic Graph</sub>_ 로 표현한다.

## 2.1. 토폴로지 구성

![processor topology|350](https://docs.confluent.io/platform/current/_images/streams-architecture-topology.jpg)
[그림 1] 카프카 스트림즈 프로세서 토폴로지 _(출처 https://docs.confluent.io/platform/current/streams/architecture.html)_

- 소스 프로세서 (Source Processor)
	- 카프카 스트림즈 애플리케이션으로 레코드를 흘려보내는 역할
	- 카프카 토픽으로부터 데이터를 읽고, 하나 이상의 스트림 프로세서로 전달
- 스트림 프로세서 (Stream Processor)
	- 데이터 처리 (변환/보강/필터 등) 로직을 실행하고 하나 이상의 스트림 프로세서 혹은 싱크 프로세서로 전달
-  싱크 프로세서 (Sink Processor)
	- 소스/스트림 프로세서를 통해 전달받은 데이터(레코드)를 다시 카프카 클러스터의 특정 토픽으로 내보내는 역할


## 2.2. 토폴로지 실행

1. 프로세서 토폴로지 초기화
2. 태스크 할당 및 쓰레드 실행: 실행 계획에 따라 태스크가 할당되고, 각 태스크는 쓰레드에 할당되어 병렬로 실행
3. 각 프로세서 실행: 태스크는 스트림에서 데이터를 읽어오고, 정의된 프로세서에 따라 데이터를 처리하며, 최종 결과를 생성하여 카프카 클러스터로 데이터를 내보낸다

** 태스크 (Tasks)
- 토폴로지를 실행하는 단위
- 스트림 쓰레드를 할당 받아 실행됨
- 하나의 카프카 스트림즈 애플리케이션 인스턴스(프로세스)에서 여러 태스크가 병렬로 실행될 수 있다.
- 스트림 쓰레드는 각각 고립되어 있기 때문에 각 태스크 또한 고립되어 동작한다. (Thread-safe)
- 하나의 태스크는 소스 토픽의 한 개 이상의 파티션에서 데이터를 읽기 때문에 파티션 수보다 더 많은 태스크를 생성하더라도 파티션 할당 받지 못한 태스크는 아무 동작도 하지 않는다.
- 깊이 우선 처리로 실행되며, 특정 시점에 하나의 태스크에는 최대 한 개의 데이터만 흐를 수 있다.
- 스트림 처리는 하나의 데이터가 처리되고 나면, 다음 데이터를 소스로부터 읽어들여 한 개씩 처리된다.

![[Pasted image 20231219032605.png|600]]
[그림 2] 두 개의 쓰레드에서 실행되는 네 개의 태스크 
_(출처 미치 시모어 저자. 오세봉 번역, 『카프카 스트림즈와 ksqlDB 정복』, 에이콘(2022), p.88)_

![[Pasted image 20231219032510.png|600]]
[그림 2] 네 개의 쓰레드에서 실행되는 네 개의 태스크 
_(출처 미치 시모어 저자. 오세봉 번역, 『카프카 스트림즈와 ksqlDB 정복』, 에이콘(2022), p.89)_
